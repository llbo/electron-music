process.env.ENV_NOW = 'dev'; process.env.WEB_PORT = 800; process.env.ELECTRON_DISABLE_SECURITY_WARNINGS = true;
var U=Object.create;var d=Object.defineProperty;var R=Object.getOwnPropertyDescriptor;var B=Object.getOwnPropertyNames;var j=Object.getPrototypeOf,A=Object.prototype.hasOwnProperty;var L=(t,e)=>{for(var i in e)d(t,i,{get:e[i],enumerable:!0})},E=(t,e,i,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of B(e))!A.call(t,r)&&r!==i&&d(t,r,{get:()=>e[r],enumerable:!(n=R(e,r))||n.enumerable});return t};var f=(t,e,i)=>(i=t!=null?U(j(t)):{},E(e||!t||!t.__esModule?d(i,"default",{value:t,enumerable:!0}):i,t)),F=t=>E(d({},"__esModule",{value:!0}),t);var $={};L($,{entry:()=>a});module.exports=F($);var z=require("electron");var h=require("electron");var T=f(require("events")),o=require("electron"),y=class{instance;emitInProcess(e,i){this.instance.emit(e,i)}emitCrossProcess(e,i){o.ipcMain?o.webContents.getAllWebContents().forEach(n=>{n.send("__eventPipe",{eventName:e,eventArgs:i})}):o.ipcRenderer&&o.ipcRenderer.invoke("__eventPipe",{eventName:e,eventArgs:i})}emitToAllProcess(e,i){this.instance.emit(e,i),o.ipcMain?o.webContents.getAllWebContents().forEach(n=>{n.send("___eventPipe",{eventName:e,eventArgs:i})}):o.ipcRenderer&&o.ipcRenderer.invoke("__eventPipe",{eventName:e,eventArgs:i,broadcast:!0})}emitToWebContents(e,i,n){o.ipcMain?typeof e=="number"?o.webContents.getAllWebContents().forEach(r=>{r.id===e&&r.send("__eventPipe",{eventName:i,eventArgs:n})}):e.send("__eventPipe",{eventName:i,eventArgs:n}):o.ipcRenderer&&o.ipcRenderer.sendTo(e,"___eventPipe",{eventName:i,eventArgs:n})}on(e,i){this.instance.on(e,i)}once(e,i){this.instance.once(e,i)}off(e,i){i?this.instance.removeListener(e,i):this.instance.removeAllListeners(e)}initEventPipe(){o.ipcRenderer?o.ipcRenderer.on("__eventPipe",(e,{eventName:i,eventArgs:n})=>{this.instance.emit(i,e,n)}):o.ipcMain&&o.ipcMain.handle("__eventPipe",(e,{eventName:i,eventArgs:n,broadcast:r})=>{this.instance.emit(i,e,n),r&&o.webContents.getAllWebContents().forEach(m=>{m.id!==e.sender.id&&m.send("__eventPipe",{eventName:i,eventArgs:n})})})}constructor(){this.instance=new T.default.EventEmitter,this.initEventPipe()}},s=new y;var c=class{getWin(e){return h.BrowserWindow.fromWebContents(e.sender)}listenEventFromWebcontents(){s.on("minimizeWindow",e=>{this.getWin(e)?.minimize()}),s.on("maxmizeWindow",e=>{this.getWin(e)?.maximize()}),s.on("unmaxmizeWindow",e=>{this.getWin(e)?.unmaximize()}),s.on("hideWindow",e=>{this.getWin(e)?.hide()}),s.on("closeWindow",e=>{this.getWin(e)?.close()})}windowMaximizeChange(e){e.on("maximize",()=>{s.emitToWebContents(e.webContents,"windowMaximized")}),e.on("unmaximize",()=>{s.emitToWebContents(e.webContents,"windowUnmaximized")})}showWhenReady(e){e.once("ready-to-show",()=>{e.show()})}hookWindowProperty(){h.ipcMain.handle("resizable",e=>this.getWin(e)?.isResizable())}init(){this.listenEventFromWebcontents(),this.hookWindowProperty()}};var b=require("electron"),W=f(require("path")),k=f(require("fs")),S=require("url"),w=f(require("os"));var C=class{getFileType(e){return e.startsWith("image")?"image":e.endsWith(".sheet")?"excel":"qitawenjian"}getMimeType(e){return e=e.substring(1),["html","htm","shtml"].includes(e)?"text/html":e==="css"?"text/css":e==="js"?"application/javascript":["jpeg","jpg"].includes(e)?"image/jpeg":e==="png"?"image/png":e==="webp"?"image/webp":e==="docx"?"application/vnd.openxmlformats-officedocument.wordprocessingml.document":e==="xlsx"?"application/vnd.openxlformats-officedocument.spreadsheetml.sheet":e==="pptx"?"application/vnd.openxlformats-officedocument.presentationml.presentation":e==="doc"?"application/msword":e==="xls"?"application/vnd.ms-excel":e==="ppt"?"application/vnd.ms-powerpoint":e==="pdf"?"application/pdf":e==="json"?"application/json":e==="wasm"?"application/wasm":e==="mp4"?"video/mp4":e==="7z"?"application/x-7z-compressed":e==="zip"?"application/zip":["bin","exe","dll","deb","dmg","iso","img","msi","msp","msm"].includes(e)?"application/octet-stream":"text/plain"}},x=new C;var u=class{regDefaultProtocol(e,i){let n=new S.URL(e.url).pathname;n=decodeURI(n);let r=W.join(__dirname,n);k.default.readFile(r,(m,I)=>{if(m){console.log("Protocol load file error",m);return}let M=x.getMimeType(W.extname(n).toLowerCase());i({mimeType:M,data:I})})}getTotalUrl(e){return process.env.ENV_NOW==="dev"?`http://localhost:${process.env.WEB_PORT}/#${e}`:process.env.ENV_NOW==="test"?`hiktest://./index.html/#${e}`:`hik://./index.html/#${e}`}load(e,i){let n=this.getTotalUrl(i);console.log("totalUrl",n),e.webContents.loadURL(n)}loadTotalUrl(e,i){e.webContents.loadURL(i)}init(){let e=process.env.ENV_NOW==="test"?"hiktest":"hik";b.protocol.registerBufferProtocol(e,(i,n)=>this.regDefaultProtocol(i,n)),b.session.defaultSession.setUserAgent(`name: HikLinkPc; platform:${w.default.platform()};arch:${w.default.arch()};user:${w.default.userInfo().username}`)}};var g=class{nodeIntegration=!0;devTools=!0;webSecurity=!1;nodeIntegrationInSubFrames=!0;nodeIntegrationInWorker=!0;worldSafeExecuteJavaScript=!0;contextIsolation=!1;allowRunningInsecureContent=!0;disableHtmlFullscreenWindowResize=!0;enableWebSQL=!1;spellcheck=!1;center=!0;webgl=!1};var l=class{width;height;maximizable=!0;resizable=!0;center=!0;x;y;alwaysOnTop;akipTaskbar;frame=!1;show=!1;WebPreferences=new g;nodeIntegrationInSubFrames=!0;nativeWindowOpen=!0;momodalable=!1;parent;movable=!0;thickFrame=!0;minHeight;minWidth};var v=require("electron");var p=class{win;param;initEvent(){this.win.on("close",()=>{for(let e=0;e<a.windowPool.items.length;e++)a.windowPool.items[e].param?.url===this.param?.url&&a.windowPool.items.splice(e,1),this.param?.isModal&&v.BrowserWindow.getAllWindows().forEach(i=>{s.emitToWebContents(i.webContents,"showMask",{flag:!1})})})}controlSize(){if(this.param?.resizable===!1){this.win.setResizable(!1);return}else if(this.param?.minSize){this.win.setMinimumSize(this.param.minSize.width,this.param.minSize.height),this.win.setResizable(!0);return}this.win.setResizable(!0),this.win.setMinimumSize(200,150)}modalSet(){this.win.setSkipTaskbar(!0),this.win.setParentWindow(a.mainWindow),v.BrowserWindow.getAllWindows().forEach(e=>{e.id!==this.win.id&&s.emitToWebContents(e.webContents,"showMask",{flag:!0})})}effectParam(e){this.param=e,this.win.setSize(this.param.size.width,this.param.size.height),this.win.setAlwaysOnTop(this.param.alwaysTop||!1),this.param.position?this.win.setPosition(this.param.position.x,this.param.position.y):this.win.center(),this.param?.isModal&&this.modalSet(),this.controlSize(),this.win.moveTop(),this.win.show()}use(e){this.effectParam(e),a.protocol.load(this.win,e.url)}constructor(){let e=new l;this.win=new v.BrowserWindow(e),this.initEvent(),a.protocol.load(this.win,"/blank")}};var P=class{items=[];init(){for(let e=0;e<3;e++)this.items.push(new p);s.on("loadWindow",(e,i)=>{this.isWindowInUse(i)||this.picAndUse(i)})}isWindowInUse(e){let i=this.items.find(n=>n.param?.url===e.url);return i?(i?.effectParam(e),!0):!1}picAndUse(e){this.items.find(n=>!n.param).use(e),this.items.push(new p)}};var _=class{mainWindow;windowPool=new P;commonWindowEvent=new c;protocol=new u;initMainWindow(){let e=new l;e.width=800,e.height=600,e.show=!0,this.mainWindow=new z.BrowserWindow(e),this.protocol.load(this.mainWindow,"/")}constructor(){z.app.on("ready",async()=>{console.log("ready"),this.protocol.init(),this.commonWindowEvent.init(),this.initMainWindow(),this.windowPool.init()})}},a=new _;0&&(module.exports={entry});
//# sourceMappingURL=entry.js.map
